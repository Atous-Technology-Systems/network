# üß† **Sistema LLM ATous Secure Network - Guia Completo**

## üìã **Vis√£o Geral**

O sistema LLM da ATous Secure Network integra o modelo **Gemma 3N** para fornecer intelig√™ncia artificial avan√ßada √† plataforma. Este sistema √© capaz de:

- **Responder perguntas** sobre o sistema de seguran√ßa
- **Analisar dados** em tempo real
- **Realizar fine-tuning** autom√°tico do sistema
- **Fornecer assist√™ncia** t√©cnica e insights
- **Otimizar par√¢metros** de seguran√ßa automaticamente

## üöÄ **Funcionalidades Principais**

### **1. Assistente Virtual Inteligente**
- **Consultas sobre o sistema**: Status, m√©tricas, configura√ß√µes
- **An√°lise de seguran√ßa**: Amea√ßas, vulnerabilidades, padr√µes
- **Assist√™ncia t√©cnica**: Configura√ß√£o, otimiza√ß√£o, troubleshooting
- **Insights autom√°ticos**: Recomenda√ß√µes baseadas em dados

### **2. Fine-Tuning Autom√°tico**
- **Otimiza√ß√£o di√°ria** dos thresholds de seguran√ßa
- **Ajuste autom√°tico** de par√¢metros ABISS/NNIS
- **Melhoria cont√≠nua** baseada em dados reais
- **Valida√ß√£o de performance** e m√©tricas

### **3. Integra√ß√£o com Sistema**
- **Acesso direto** aos dados de seguran√ßa
- **Contexto em tempo real** do sistema
- **An√°lise de logs** e m√©tricas
- **Respostas contextualizadas** e precisas

## üîå **Endpoints da API**

### **REST API**

#### **POST `/api/llm/query`**
**Consultar o LLM com uma pergunta**

```json
{
  "question": "Quais foram as √∫ltimas amea√ßas bloqueadas pelo sistema?",
  "context": {
    "include_security_data": true,
    "include_user_stats": true
  },
  "include_system_context": true
}
```

**Resposta:**
```json
{
  "answer": "Com base nos dados do sistema, foram bloqueadas 15 amea√ßas nas √∫ltimas 24 horas...",
  "confidence": 0.85,
  "sources": ["llm", "abiss", "system_metrics"],
  "metadata": {
    "question_type": "security_threat",
    "response_length": 245,
    "has_context": true
  },
  "timestamp": "2025-01-17T20:30:00Z",
  "processing_time": 1.23
}
```

#### **POST `/api/llm/fine-tuning`**
**Iniciar fine-tuning manual**

```json
{
  "force": false
}
```

**Resposta:**
```json
{
  "success": true,
  "improvements": {
    "abiss_threshold": 0.02,
    "nnis_sensitivity": 0.03,
    "response_time": 0.05
  },
  "new_thresholds": {
    "abiss_threat_threshold": 0.93,
    "nnis_threat_threshold": 0.92,
    "rate_limit_threshold": 0.85
  },
  "training_loss": 0.15,
  "timestamp": "2025-01-17T20:30:00Z",
  "message": "Fine-tuning conclu√≠do com sucesso"
}
```

#### **GET `/api/llm/status`**
**Status do servi√ßo LLM**

**Resposta:**
```json
{
  "is_loaded": true,
  "is_training": false,
  "model_path": "models/gemma-3n/extracted",
  "metrics": {
    "total_queries": 150,
    "successful_responses": 148,
    "average_response_time": 1.45,
    "cache_size": 45,
    "is_loaded": true,
    "is_training": false
  },
  "last_fine_tuning": "2025-01-17T18:00:00Z"
}
```

#### **POST `/api/llm/load-model`**
**Carregar modelo manualmente**

**Resposta:**
```json
{
  "message": "Modelo carregado com sucesso"
}
```

#### **GET `/api/llm/context`**
**Contexto atual do sistema**

**Resposta:**
```json
{
  "timestamp": "2025-01-17T20:30:00Z",
  "system_status": "operational",
  "abiss": {
    "status": "active",
    "threats_blocked": 15,
    "total_requests": 1250
  },
  "nnis": {
    "status": "active",
    "immune_cells": 45,
    "memory_cells": 120
  },
  "users": {
    "total": 25,
    "active": 23,
    "recent": 3
  }
}
```

### **WebSocket API**

#### **WebSocket `/api/llm/ws`**
**Comunica√ß√£o em tempo real com o LLM**

**Mensagens de entrada:**

1. **Consulta:**
```json
{
  "type": "query",
  "question": "Como est√° o sistema de seguran√ßa hoje?",
  "context": {
    "include_performance_metrics": true
  }
}
```

2. **Fine-tuning:**
```json
{
  "type": "fine_tuning",
  "force": false
}
```

3. **Ping:**
```json
{
  "type": "ping"
}
```

**Mensagens de sa√≠da:**

1. **Boas-vindas:**
```json
{
  "type": "welcome",
  "message": "Conectado ao assistente LLM da ATous Secure Network",
  "timestamp": "2025-01-17T20:30:00Z",
  "capabilities": [
    "Consultas sobre o sistema",
    "An√°lise de seguran√ßa",
    "Assist√™ncia t√©cnica",
    "Fine-tuning autom√°tico"
  ]
}
```

2. **Processando:**
```json
{
  "type": "processing",
  "message": "Processando sua pergunta...",
  "timestamp": "2025-01-17T20:30:00Z"
}
```

3. **Resposta:**
```json
{
  "type": "response",
  "data": {
    "answer": "O sistema de seguran√ßa est√° funcionando perfeitamente...",
    "confidence": 0.88,
    "sources": ["llm", "system_metrics"],
    "metadata": {
      "question_type": "system_status",
      "response_length": 156,
      "has_context": true
    },
    "timestamp": "2025-01-17T20:30:00Z"
  }
}
```

4. **Fine-tuning iniciado:**
```json
{
  "type": "fine_tuning_started",
  "message": "Iniciando fine-tuning...",
  "timestamp": "2025-01-17T20:30:00Z"
}
```

5. **Fine-tuning conclu√≠do:**
```json
{
  "type": "fine_tuning_completed",
  "data": {
    "success": true,
    "improvements": {
      "abiss_threshold": 0.02,
      "nnis_sensitivity": 0.03
    },
    "new_thresholds": {
      "abiss_threat_threshold": 0.93,
      "nnis_threat_threshold": 0.92
    },
    "training_loss": 0.15,
    "timestamp": "2025-01-17T20:30:00Z"
  }
}
```

## üí° **Exemplos de Uso**

### **1. Consultas sobre Seguran√ßa**

#### **Amea√ßas Recentes**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Quais foram as √∫ltimas amea√ßas bloqueadas pelo sistema?",
    "include_system_context": true
  }'
```

#### **An√°lise de Vulnerabilidades**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Existem vulnerabilidades cr√≠ticas no sistema?",
    "context": {
      "include_security_data": true,
      "include_performance_metrics": true
    }
  }'
```

### **2. Consultas sobre Usu√°rios**

#### **Estat√≠sticas de Usu√°rios**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Quantos usu√°rios foram cadastrados recentemente?",
    "include_system_context": true
  }'
```

#### **An√°lise de Atividade**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Qual √© o padr√£o de atividade dos usu√°rios?",
    "context": {
      "include_user_stats": true,
      "include_performance_metrics": true
    }
  }'
```

### **3. Consultas sobre Performance**

#### **Status do Sistema**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Como est√° a performance do sistema hoje?",
    "include_system_context": true
  }'
```

#### **Otimiza√ß√µes Recomendadas**
```bash
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Que otimiza√ß√µes voc√™ recomenda para o sistema?",
    "context": {
      "include_performance_metrics": true,
      "include_security_data": true
    }
  }'
```

## üîß **Configura√ß√£o e Personaliza√ß√£o**

### **Vari√°veis de Ambiente**

```bash
# Configura√ß√µes do modelo
GEMMA_MODEL_PATH=models/gemma-3n/extracted
GEMMA_MAX_LENGTH=2048
GEMMA_TEMPERATURE=0.7
GEMMA_TOP_P=0.9

# Configura√ß√µes de fine-tuning
LLM_AUTO_FINE_TUNING=true
LLM_FINE_TUNING_INTERVAL=24
LLM_MIN_IMPROVEMENT_THRESHOLD=0.01

# Configura√ß√µes de cache
LLM_CACHE_ENABLED=true
LLM_CACHE_TTL=3600
LLM_CACHE_MAX_SIZE=1000
```

### **Arquivo de Configura√ß√£o YAML**

```yaml
llm:
  model:
    path: "models/gemma-3n/extracted"
    max_length: 2048
    temperature: 0.7
    top_p: 0.9
  
  fine_tuning:
    auto_enabled: true
    interval_hours: 24
    min_improvement: 0.01
    max_training_time: 30
  
  cache:
    enabled: true
    ttl_seconds: 3600
    max_size: 1000
    eviction_policy: "lru"
  
  context:
    max_length: 2000
    include_system_info: true
    include_security_data: true
    include_user_stats: true
```

## üìä **M√©tricas e Monitoramento**

### **M√©tricas do Servi√ßo**

- **Total de consultas**: N√∫mero total de perguntas processadas
- **Taxa de sucesso**: Porcentagem de respostas bem-sucedidas
- **Tempo m√©dio de resposta**: Performance do modelo
- **Tamanho do cache**: Efici√™ncia do sistema de cache
- **Status de carregamento**: Estado do modelo
- **Status de treinamento**: Estado do fine-tuning

### **Monitoramento em Tempo Real**

```bash
# Status do servi√ßo
curl "http://127.0.0.1:8000/api/llm/status"

# Contexto do sistema
curl "http://127.0.0.1:8000/api/llm/context"

# Health check
curl "http://127.0.0.1:8000/health/detailed"
```

## üö® **Solu√ß√£o de Problemas**

### **Problemas Comuns**

#### **1. Modelo n√£o carregado**
```bash
# Verificar status
curl "http://127.0.0.1:8000/api/llm/status"

# Carregar manualmente
curl -X POST "http://127.0.0.1:8000/api/llm/load-model"
```

#### **2. Respostas lentas**
```bash
# Verificar m√©tricas
curl "http://127.0.0.1:8000/api/llm/status"

# Verificar contexto do sistema
curl "http://127.0.0.1:8000/api/llm/context"
```

#### **3. Fine-tuning falhando**
```bash
# Verificar logs
tail -f logs/llm_service.log

# For√ßar fine-tuning
curl -X POST "http://127.0.0.1:8000/api/llm/fine-tuning" \
  -H "Content-Type: application/json" \
  -d '{"force": true}'
```

### **Logs e Debugging**

```bash
# Logs do servi√ßo LLM
tail -f logs/llm_service.log

# Logs do sistema
tail -f logs/atous_sec_network.log

# Logs de erro
grep "ERROR" logs/llm_service.log
```

## üîí **Seguran√ßa e Privacidade**

### **Prote√ß√µes Implementadas**

- **Valida√ß√£o de entrada**: Todas as perguntas s√£o validadas
- **Sanitiza√ß√£o de contexto**: Dados sens√≠veis s√£o filtrados
- **Rate limiting**: Prote√ß√£o contra abuso
- **Logs de auditoria**: Rastreamento de todas as consultas
- **Isolamento de contexto**: Separa√ß√£o entre usu√°rios

### **Configura√ß√µes de Seguran√ßa**

```yaml
security:
  input_validation: true
  context_sanitization: true
  rate_limiting: true
  audit_logging: true
  max_question_length: 1000
  max_context_size: 5000
```

## üìö **Recursos Adicionais**

### **Documenta√ß√£o Relacionada**

- [WEBSOCKET_GUIDE.md](./WEBSOCKET_GUIDE.md) - Guia de WebSockets
- [WEBSOCKET_API.md](./WEBSOCKET_API.md) - API de WebSockets
- [collection.json](./collection.json) - Collection Postman completa

### **Exemplos de Cliente**

#### **JavaScript (Browser)**
```javascript
// Conectar ao WebSocket LLM
const ws = new WebSocket('ws://127.0.0.1:8000/api/llm/ws');

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  console.log('Resposta:', message);
};

// Fazer pergunta
ws.send(JSON.stringify({
  type: 'query',
  question: 'Como est√° o sistema de seguran√ßa?'
}));
```

#### **Python**
```python
import requests
import json

# Consulta REST
response = requests.post(
    'http://127.0.0.1:8000/api/llm/query',
    json={
        'question': 'Quais foram as √∫ltimas amea√ßas?',
        'include_system_context': True
    }
)

print(json.dumps(response.json(), indent=2))
```

#### **cURL**
```bash
# Consulta simples
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{"question": "Status do sistema?"}'

# Com contexto
curl -X POST "http://127.0.0.1:8000/api/llm/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "An√°lise de seguran√ßa",
    "context": {"include_security_data": true}
  }'
```

## üéØ **Pr√≥ximos Passos**

### **Melhorias Planejadas**

1. **Modelos especializados** para diferentes dom√≠nios
2. **Fine-tuning adaptativo** baseado em feedback
3. **Integra√ß√£o com mais fontes** de dados
4. **Interface web** para consultas interativas
5. **An√°lise preditiva** de amea√ßas

### **Roadmap de Desenvolvimento**

- **Fase 1**: Sistema b√°sico funcionando ‚úÖ
- **Fase 2**: Fine-tuning autom√°tico ‚úÖ
- **Fase 3**: Interface web interativa üîÑ
- **Fase 4**: Modelos especializados üìã
- **Fase 5**: An√°lise preditiva üìã

---

**üéä O sistema LLM da ATous Secure Network est√° pronto para uso! üéä**

**Status**: ‚úÖ **FUNCIONAL E TESTADO**
**Modelo**: Gemma 3N integrado
**Capacidades**: Consultas, fine-tuning, assist√™ncia
**Integra√ß√£o**: 100% com sistema de seguran√ßa
