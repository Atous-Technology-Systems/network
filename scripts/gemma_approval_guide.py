#!/usr/bin/env python3
"""
Guia completo para obter aprova√ß√£o do Gemma 3N
"""

import webbrowser
import time
from pathlib import Path

def show_approval_steps():
    """Mostra os passos para obter aprova√ß√£o"""
    print("üîê Guia Completo: Como Obter Aprova√ß√£o para Gemma 3N")
    print("=" * 60)
    
    print("\nüìã OP√á√ïES DISPON√çVEIS:")
    print("1. Hugging Face (Recomendado)")
    print("2. Kaggle (Alternativa)")
    print("3. Ambos (M√°xima compatibilidade)")

def huggingface_approval_steps():
    """Passos para aprova√ß√£o no Hugging Face"""
    print("\nü§ó APROVA√á√ÉO NO HUGGING FACE")
    print("=" * 40)
    
    steps = [
        {
            "step": 1,
            "title": "Criar/Verificar Conta Hugging Face",
            "actions": [
                "Acesse: https://huggingface.co/join",
                "Crie uma conta ou fa√ßa login",
                "Verifique seu email se necess√°rio"
            ],
            "url": "https://huggingface.co/join"
        },
        {
            "step": 2,
            "title": "Acessar P√°gina do Modelo Gemma 3N",
            "actions": [
                "Visite: https://huggingface.co/google/gemma-3n-E4B",
                "Leia a descri√ß√£o do modelo",
                "Verifique os requisitos de uso"
            ],
            "url": "https://huggingface.co/google/gemma-3n-E4B"
        },
        {
            "step": 3,
            "title": "Solicitar Acesso",
            "actions": [
                "Clique no bot√£o 'Request access'",
                "Preencha o formul√°rio de solicita√ß√£o",
                "Descreva seu caso de uso (pesquisa/desenvolvimento)",
                "Aguarde aprova√ß√£o (geralmente 1-7 dias)"
            ],
            "url": "https://huggingface.co/google/gemma-3n-E4B"
        },
        {
            "step": 4,
            "title": "Configurar Token de Acesso",
            "actions": [
                "V√° para: https://huggingface.co/settings/tokens",
                "Crie um novo token (se n√£o tiver)",
                "Copie o token gerado",
                "Configure na aplica√ß√£o"
            ],
            "url": "https://huggingface.co/settings/tokens"
        }
    ]
    
    for step_info in steps:
        print(f"\nüìå PASSO {step_info['step']}: {step_info['title']}")
        print("-" * 30)
        for action in step_info['actions']:
            print(f"   ‚Ä¢ {action}")
        
        if 'url' in step_info:
            choice = input(f"\n   Abrir URL agora? (y/n): ").lower().strip()
            if choice in ['y', 'yes', 'sim']:
                try:
                    webbrowser.open(step_info['url'])
                    print(f"   üåê Abrindo: {step_info['url']}")
                    time.sleep(2)
                except:
                    print(f"   ‚ö†Ô∏è  N√£o foi poss√≠vel abrir automaticamente")
                    print(f"   üìã Copie manualmente: {step_info['url']}")

def kaggle_approval_steps():
    """Passos para aprova√ß√£o no Kaggle"""
    print("\nüèÜ APROVA√á√ÉO NO KAGGLE")
    print("=" * 30)
    
    steps = [
        {
            "step": 1,
            "title": "Criar/Verificar Conta Kaggle",
            "actions": [
                "Acesse: https://www.kaggle.com/account/login",
                "Crie uma conta ou fa√ßa login",
                "Verifique seu n√∫mero de telefone (obrigat√≥rio)"
            ],
            "url": "https://www.kaggle.com/account/login"
        },
        {
            "step": 2,
            "title": "Acessar Gemma 3N no Kaggle",
            "actions": [
                "Visite: https://www.kaggle.com/models/google/gemma-3n",
                "Leia os termos de uso",
                "Verifique a documenta√ß√£o"
            ],
            "url": "https://www.kaggle.com/models/google/gemma-3n"
        },
        {
            "step": 3,
            "title": "Aceitar Termos de Uso",
            "actions": [
                "Clique em 'Accept Terms'",
                "Leia e aceite os termos do Google",
                "Confirme seu caso de uso",
                "Acesso geralmente liberado imediatamente"
            ],
            "url": "https://www.kaggle.com/models/google/gemma-3n"
        },
        {
            "step": 4,
            "title": "Configurar API Token",
            "actions": [
                "V√° para: https://www.kaggle.com/settings/account",
                "Se√ß√£o 'API' -> 'Create New Token'",
                "Baixe o arquivo kaggle.json",
                "Configure na aplica√ß√£o"
            ],
            "url": "https://www.kaggle.com/settings/account"
        }
    ]
    
    for step_info in steps:
        print(f"\nüìå PASSO {step_info['step']}: {step_info['title']}")
        print("-" * 30)
        for action in step_info['actions']:
            print(f"   ‚Ä¢ {action}")
        
        if 'url' in step_info:
            choice = input(f"\n   Abrir URL agora? (y/n): ").lower().strip()
            if choice in ['y', 'yes', 'sim']:
                try:
                    webbrowser.open(step_info['url'])
                    print(f"   üåê Abrindo: {step_info['url']}")
                    time.sleep(2)
                except:
                    print(f"   ‚ö†Ô∏è  N√£o foi poss√≠vel abrir automaticamente")
                    print(f"   üìã Copie manualmente: {step_info['url']}")

def configure_huggingface_token():
    """Configura token do Hugging Face"""
    print("\nüîë CONFIGURAR TOKEN HUGGING FACE")
    print("=" * 40)
    
    print("Op√ß√µes para configurar o token:")
    print("1. Configura√ß√£o autom√°tica (recomendado)")
    print("2. Configura√ß√£o manual")
    print("3. Vari√°vel de ambiente")
    
    choice = input("\nEscolha (1-3): ").strip()
    
    if choice == "1":
        try:
            from huggingface_hub import login
            print("\nüåê Abrindo login do Hugging Face...")
            login()
            print("‚úÖ Token configurado com sucesso!")
            return True
        except Exception as e:
            print(f"‚ùå Erro: {e}")
            return False
    
    elif choice == "2":
        token = input("\nüîë Cole seu token do Hugging Face: ").strip()
        if token:
            try:
                from huggingface_hub import login
                login(token=token)
                print("‚úÖ Token configurado com sucesso!")
                return True
            except Exception as e:
                print(f"‚ùå Erro: {e}")
                return False
        else:
            print("‚ùå Token n√£o fornecido")
            return False
    
    elif choice == "3":
        print("\nüìù Configura√ß√£o via vari√°vel de ambiente:")
        print("1. Crie um arquivo .env na raiz do projeto")
        print("2. Adicione: HUGGINGFACE_TOKEN=seu_token_aqui")
        print("3. Ou execute: export HUGGINGFACE_TOKEN=seu_token")
        
        # Criar arquivo .env
        token = input("\nüîë Cole seu token (ou Enter para pular): ").strip()
        if token:
            with open(".env", "w") as f:
                f.write(f"HUGGINGFACE_TOKEN={token}\n")
            print("‚úÖ Token salvo em .env")
            return True
        else:
            print("‚ö†Ô∏è  Token n√£o configurado")
            return False
    
    return False

def configure_kaggle_token():
    """Configura token do Kaggle"""
    print("\nüèÜ CONFIGURAR TOKEN KAGGLE")
    print("=" * 30)
    
    print("Para usar modelos do Kaggle:")
    print("1. Baixe kaggle.json das configura√ß√µes da conta")
    print("2. Coloque em ~/.kaggle/kaggle.json (Linux/Mac)")
    print("3. Ou em C:\\Users\\{username}\\.kaggle\\kaggle.json (Windows)")
    
    choice = input("\nJ√° baixou o kaggle.json? (y/n): ").lower().strip()
    
    if choice in ['y', 'yes', 'sim']:
        kaggle_path = Path.home() / ".kaggle"
        kaggle_path.mkdir(exist_ok=True)
        
        print(f"\nüìÅ Coloque o arquivo kaggle.json em: {kaggle_path}")
        print("   Ou configure manualmente:")
        
        username = input("   Username Kaggle (ou Enter para pular): ").strip()
        key = input("   API Key (ou Enter para pular): ").strip()
        
        if username and key:
            kaggle_config = {
                "username": username,
                "key": key
            }
            
            import json
            with open(kaggle_path / "kaggle.json", "w") as f:
                json.dump(kaggle_config, f)
            
            # Definir permiss√µes no Linux/Mac
            try:
                import os
                os.chmod(kaggle_path / "kaggle.json", 0o600)
            except:
                pass
            
            print("‚úÖ Configura√ß√£o Kaggle salva!")
            return True
    
    print("‚ö†Ô∏è  Configure manualmente o kaggle.json")
    return False

def test_access():
    """Testa acesso aos modelos"""
    print("\nüß™ TESTAR ACESSO AOS MODELOS")
    print("=" * 35)
    
    # Testar Hugging Face
    print("ü§ó Testando Hugging Face...")
    try:
        from transformers import AutoTokenizer
        tokenizer = AutoTokenizer.from_pretrained("google/gemma-3n-E4B")
        print("‚úÖ Hugging Face: Acesso liberado!")
        hf_success = True
    except Exception as e:
        print(f"‚ùå Hugging Face: {str(e)[:100]}...")
        hf_success = False
    
    # Testar Kaggle (se dispon√≠vel)
    print("\nüèÜ Testando Kaggle...")
    try:
        import kaggle
        # Tentar listar modelos (teste b√°sico)
        print("‚úÖ Kaggle: API configurada!")
        kaggle_success = True
    except Exception as e:
        print(f"‚ùå Kaggle: {str(e)[:100]}...")
        kaggle_success = False
    
    return hf_success, kaggle_success

def create_approval_checklist():
    """Cria checklist de aprova√ß√£o"""
    checklist = """
# ‚úÖ Checklist de Aprova√ß√£o Gemma 3N

## ü§ó Hugging Face
- [ ] Conta criada/verificada
- [ ] Acesso solicitado em: https://huggingface.co/google/gemma-3n-E4B
- [ ] Token de acesso criado
- [ ] Token configurado na aplica√ß√£o
- [ ] Teste de acesso realizado

## üèÜ Kaggle (Alternativa)
- [ ] Conta criada/verificada
- [ ] Telefone verificado
- [ ] Termos aceitos em: https://www.kaggle.com/models/google/gemma-3n
- [ ] API token baixado (kaggle.json)
- [ ] Token configurado no sistema
- [ ] Teste de acesso realizado

## üîß Configura√ß√£o da Aplica√ß√£o
- [ ] Token configurado
- [ ] Modelo testado: python start_app.py --full
- [ ] Logs verificados (sem erros de acesso)
- [ ] Sistema funcionando com Gemma 3N

## üìû Suporte
Se tiver problemas:
- Hugging Face: https://huggingface.co/support
- Kaggle: https://www.kaggle.com/contact
- Documenta√ß√£o Gemma: https://ai.google.dev/gemma

## ‚è±Ô∏è Tempo Esperado
- Hugging Face: 1-7 dias √∫teis
- Kaggle: Imediato (ap√≥s verifica√ß√£o telef√¥nica)
"""
    
    with open("gemma_approval_checklist.md", "w", encoding="utf-8") as f:
        f.write(checklist)
    
    print("üìã Checklist salvo em: gemma_approval_checklist.md")

def main():
    """Fun√ß√£o principal"""
    print("üöÄ Guia de Aprova√ß√£o Gemma 3N - ATous Secure Network")
    print("=" * 60)
    
    show_approval_steps()
    
    choice = input("\nEscolha uma op√ß√£o (1-3): ").strip()
    
    if choice == "1":
        huggingface_approval_steps()
        print("\nüîë Configurar token agora?")
        if input("(y/n): ").lower().strip() in ['y', 'yes', 'sim']:
            configure_huggingface_token()
    
    elif choice == "2":
        kaggle_approval_steps()
        print("\nüîë Configurar token agora?")
        if input("(y/n): ").lower().strip() in ['y', 'yes', 'sim']:
            configure_kaggle_token()
    
    elif choice == "3":
        print("\nüéØ Configurando ambas as plataformas...")
        huggingface_approval_steps()
        configure_huggingface_token()
        print("\n" + "="*40)
        kaggle_approval_steps()
        configure_kaggle_token()
    
    else:
        print("‚ùå Op√ß√£o inv√°lida")
    
    # Testar acesso
    print("\nüß™ Testar acesso agora?")
    if input("(y/n): ").lower().strip() in ['y', 'yes', 'sim']:
        test_access()
    
    # Criar checklist
    create_approval_checklist()
    
    print("\nüéâ Guia de aprova√ß√£o conclu√≠do!")
    print("\nüìã Pr√≥ximos passos:")
    print("1. Siga os passos mostrados acima")
    print("2. Aguarde aprova√ß√£o (se necess√°rio)")
    print("3. Configure o token na aplica√ß√£o")
    print("4. Teste: python start_app.py --full")
    
    print("\nüí° Dicas importantes:")
    print("‚Ä¢ Hugging Face: Mais comum, pode demorar alguns dias")
    print("‚Ä¢ Kaggle: Mais r√°pido, mas requer verifica√ß√£o telef√¥nica")
    print("‚Ä¢ Use caso de uso leg√≠timo (pesquisa/desenvolvimento)")
    print("‚Ä¢ Mantenha tokens seguros e privados")

if __name__ == "__main__":
    main()